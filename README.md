# README

## Описание проекта

Данный проект представляет собой веб-скрапер для сайта [anekdoty.ru](https://anekdoty.ru). Скрипт собирает анекдоты из всех категорий, включая данные о рейтинге, ID, тексте и категории, а затем сохраняет их в базу данных PostgreSQL.

## Структура проекта

- **`scraper.js`**  
  Основной скрипт для парсинга сайта. Реализует функции для сбора категорий, анекдотов и сохранения их в базу данных.

- **`knexfile.js`**  
  Конфигурационный файл для ORM Knex.js, содержит настройки подключения к базе данных.

- **`docker-compose.yml`**  
  Описание Docker-контейнеров для PostgreSQL и PgAdmin, обеспечивающих удобную настройку и управление базой данных.

- **Папка `migrations`**  
  Содержит миграции для создания таблиц `categories` и `jokes`.

## Установка

1. **Клонирование репозитория**

   ```bash
   git clone <URL репозитория>
   cd <папка с проектом>
   ```

2. **Установка зависимостей**

   ```bash
   npm install
   ```

3. **Настройка переменных окружения**  
   По желанию создайте файл `.env` в корне проекта с содержимым переменных окружения:

   ```plaintext
   DB_HOST=
   DB_PORT=
   DB_NAME=
   DB_USER=
   DB_PASSWORD=
   PGADMIN_PORT=
   PGADMIN_DEFAULT_EMAIL=
   PGADMIN_DEFAULT_PASSWORD=
   ```

4. **Запуск Docker-контейнеров**  
   Выполните команду для запуска базы данных и PgAdmin:

   ```bash
   docker-compose up -d
   ```

5. **Применение миграций**  
   После запуска базы данных выполните миграции для создания необходимых таблиц:
   ```bash
   npx knex migrate:latest
   ```

## Использование

1. **Запуск скрипта парсинга**  
   Для старта основного процесса парсинга выполните:

   ```bash
   node scraper.js
   ```

2. **Просмотр данных в PgAdmin**  
   Откройте [http://localhost:5050](http://localhost:5050), войдите с учетными данными из `.env`, подключитесь к базе данных PostgreSQL и просмотрите таблицы `categories` и `jokes`.

## Структура базы данных

### Таблица `categories`

| Поле         | Тип       | Описание                                             |
| ------------ | --------- | ---------------------------------------------------- |
| `id`         | INTEGER   | Уникальный идентификатор категории (первичный ключ). |
| `category`   | VARCHAR   | Название категории (уникальное значение).            |
| `url`        | VARCHAR   | URL категории (уникальный).                          |
| `created_at` | TIMESTAMP | Дата и время создания записи.                        |
| `updated_at` | TIMESTAMP | Дата и время последнего обновления записи.           |

### Таблица `jokes`

| Поле         | Тип       | Описание                                            |
| ------------ | --------- | --------------------------------------------------- |
| `joke_id`    | INTEGER   | Уникальный идентификатор анекдота (первичный ключ). |
| `content`    | TEXT      | Текст анекдота.                                     |
| `rating`     | INTEGER   | Рейтинг анекдота.                                   |
| `created_at` | TIMESTAMP | Дата и время создания записи.                       |
| `updated_at` | TIMESTAMP | Дата и время последнего обновления записи.          |

### Таблица `joke_categories`

| Поле          | Тип     | Описание                                              |
| ------------- | ------- | ----------------------------------------------------- |
| `joke_id`     | INTEGER | Ссылка на `joke_id` в таблице `jokes` (внешний ключ). |
| `category_id` | INTEGER | Ссылка на `id` в таблице `categories` (внешний ключ). |
